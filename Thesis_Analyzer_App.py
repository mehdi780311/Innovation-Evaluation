import streamlit as st
import pandas as pd
import google.generativeai as genai
import io
from time import sleep

# --- Page Configuration ---
# ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡ ØµÙØ­Ù‡ Ø´Ø§Ù…Ù„ Ø¹Ù†ÙˆØ§Ù†ØŒ Ø¢ÛŒÚ©ÙˆÙ† Ùˆ Ø·Ø±Ø­â€ŒØ¨Ù†Ø¯ÛŒ
st.set_page_config(
    page_title="ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡ Ø¯Ø§Ø±ÙˆØ³Ø§Ø²ÛŒ",
    page_icon="ğŸ§ª",
    layout="wide",
    initial_sidebar_state="expanded"
)

# --- Functions ---

def create_prompt(title, abstract):
    """
    Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ ÛŒÚ© Ø¯Ø³ØªÙˆØ± (prompt) Ø¯Ù‚ÛŒÙ‚ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
    """
    return f"""
        Ø´Ù…Ø§ ÛŒÚ© Ù…ØªØ®ØµØµ Ù†Ø®Ø¨Ù‡ Ø¯Ø± Ø²Ù…ÛŒÙ†Ù‡ Ø¹Ù„ÙˆÙ… Ø¯Ø§Ø±ÙˆÛŒÛŒØŒ ØªÙˆØ³Ø¹Ù‡ Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø± Ùˆ Ø§Ù†ØªÙ‚Ø§Ù„ ÙÙ†Ø§ÙˆØ±ÛŒ Ù‡Ø³ØªÛŒØ¯.
        ÙˆØ¸ÛŒÙÙ‡ Ø´Ù…Ø§ ØªØ­Ù„ÛŒÙ„ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ú†Ú©ÛŒØ¯Ù‡ Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡ Ø²ÛŒØ± Ø§Ø² Ø±Ø´ØªÙ‡ Ø¯Ø§Ø±ÙˆØ³Ø§Ø²ÛŒ Ø§Ø³Øª.
        Ø¢Ù† Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ù‡ Ù…Ø¹ÛŒØ§Ø± Ø§ØµÙ„ÛŒ Ø¨Ø§ Ø¯Ù‚Øª Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ú©Ù†ÛŒØ¯:
        1.  **Ù¾ØªØ§Ù†Ø³ÛŒÙ„ ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ (Commercialization Potential):** Ø¢ÛŒØ§ Ø§ÛŒÙ† Ø§ÛŒØ¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ ÛŒÚ© Ù…Ø­ØµÙˆÙ„ØŒ Ø³Ø±ÙˆÛŒØ³ ÛŒØ§ Ù¾ØªÙ†Øª Ø³ÙˆØ¯Ø¢ÙˆØ± ØªØ¨Ø¯ÛŒÙ„ Ø´ÙˆØ¯ØŸ Ø¨Ø§Ø²Ø§Ø± Ù‡Ø¯Ù Ø¢Ù† Ú†ÛŒØ³ØªØŸ
        2.  **Ø³Ø·Ø­ Ù†ÙˆØ¢ÙˆØ±ÛŒ (Innovation Level):** Ø¢ÛŒØ§ Ø§ÛŒÙ† ØªØ­Ù‚ÛŒÙ‚ ÛŒÚ© Ø±ÙˆÛŒÚ©Ø±Ø¯ Ø¬Ø¯ÛŒØ¯ØŒ Ø±ÙˆØ´ Ù†ÙˆÛŒÙ† ÛŒØ§ Ú©Ø´Ù Ø¨Ø¯ÛŒØ¹ Ø±Ø§ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯ØŸ Ø¯Ø± Ù…Ù‚Ø§ÛŒØ³Ù‡ Ø¨Ø§ Ø¯Ø§Ù†Ø´ Ù…ÙˆØ¬ÙˆØ¯ Ú†Ù‚Ø¯Ø± Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡ Ø§Ø³ØªØŸ
        3.  **Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ (Value Creation Potential):** Ø§ÛŒÙ† ØªØ­Ù‚ÛŒÙ‚ Ú†Ù‡ Ù…Ø´Ú©Ù„ÛŒ Ø±Ø§ Ø­Ù„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ Ú†Ù‡ Ø§Ø±Ø²Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù†ØŒ ØµÙ†Ø¹Øª Ø¯Ø§Ø±ÙˆØ³Ø§Ø²ÛŒ ÛŒØ§ Ø¬Ø§Ù…Ø¹Ù‡ Ø¹Ù„Ù…ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ØŸ

        Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ù…Ø¹ÛŒØ§Ø± ÛŒÚ© Ø§Ù…ØªÛŒØ§Ø² Ø§Ø² Û± ØªØ§ Û±Û° Ø¨Ø¯Ù‡ÛŒØ¯. Ø³Ù¾Ø³ ÛŒÚ© ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ Ùˆ Ù…Ø®ØªØµØ± (Ø­Ø¯Ø§Ú©Ø«Ø± Û²-Û³ Ø¬Ù…Ù„Ù‡) Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯.
        Ø®Ø±ÙˆØ¬ÛŒ Ø±Ø§ **Ø¯Ù‚ÛŒÙ‚Ø§** Ø¨Ø§ ÙØ±Ù…Øª Ø²ÛŒØ± Ùˆ ÙÙ‚Ø· Ø¨Ù‡ Ø²Ø¨Ø§Ù† ÙØ§Ø±Ø³ÛŒ Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡ÛŒØ¯:

        Ù†ÙˆØ¢ÙˆØ±ÛŒ: [Ø§Ù…ØªÛŒØ§Ø²]/10
        ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ: [Ø§Ù…ØªÛŒØ§Ø²]/10
        Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ: [Ø§Ù…ØªÛŒØ§Ø²]/10
        ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ: [Ø®Ù„Ø§ØµÙ‡ ØªØ­Ù„ÛŒÙ„ Ø´Ù…Ø§ Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§]

        ---
        **Ø¹Ù†ÙˆØ§Ù† Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡:** {title}

        **Ú†Ú©ÛŒØ¯Ù‡ Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡:** {abstract}
        ---
    """

def parse_response(text):
    """
    Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ù¾Ø§Ø³Ø® Ø³Ø§Ø®ØªØ§Ø±ÛŒØ§ÙØªÙ‡ Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø±Ø§ ØªØ¬Ø²ÛŒÙ‡ Ú©Ø±Ø¯Ù‡ Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ù‡Ø§ Ùˆ Ø®Ù„Ø§ØµÙ‡ Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
    """
    data = {
        "Ù†ÙˆØ¢ÙˆØ±ÛŒ": "N/A",
        "ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ": "N/A",
        "Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ": "N/A",
        "ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ": "Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø§Ø³Ø® Ù…Ø¯Ù„."
    }
    try:
        lines = text.strip().split('\n')
        for line in lines:
            if "Ù†ÙˆØ¢ÙˆØ±ÛŒ:" in line:
                data["Ù†ÙˆØ¢ÙˆØ±ÛŒ"] = line.split(':')[1].strip().split('/')[0]
            elif "ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ:" in line:
                data["ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ"] = line.split(':')[1].strip().split('/')[0]
            elif "Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ:" in line:
                data["Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ"] = line.split(':')[1].strip().split('/')[0]
            elif "ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ:" in line:
                data["ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ"] = line.split(':', 1)[1].strip()
    except Exception:
        # Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ø®Ø·Ø§ Ø¯Ø± ØªØ¬Ø²ÛŒÙ‡ØŒ Ø§Ø² Ù¾ÛŒØ§Ù… Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
        pass
    return data

def to_excel(df):
    """
    ÛŒÚ© DataFrame Ø±Ø§ Ø¨Ù‡ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ (in-memory) ØªØ¨Ø¯ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
    """
    output = io.BytesIO()
    with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
        df.to_excel(writer, index=False, sheet_name='ØªØ­Ù„ÛŒÙ„_Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§')
        # ØªÙ†Ø¸ÛŒÙ… Ø®ÙˆØ¯Ú©Ø§Ø± Ø¹Ø±Ø¶ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±
        for column in df:
            column_length = max(df[column].astype(str).map(len).max(), len(column)) + 2
            col_idx = df.columns.get_loc(column)
            writer.sheets['ØªØ­Ù„ÛŒÙ„_Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§'].set_column(col_idx, col_idx, column_length)
    processed_data = output.getvalue()
    return processed_data


# --- Streamlit App UI ---

st.title("ğŸ§ª ØªØ­Ù„ÛŒÙ„Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø§Ø±ÙˆØ³Ø§Ø²ÛŒ")
st.markdown("Ø§ÛŒÙ† Ø§Ø¨Ø²Ø§Ø± Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ GeminiØŒ Ù¾ØªØ§Ù†Ø³ÛŒÙ„ **ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ**ØŒ **Ù†ÙˆØ¢ÙˆØ±ÛŒ** Ùˆ **Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ** Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ú†Ú©ÛŒØ¯Ù‡ ØªØ­Ù„ÛŒÙ„ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.")

# Ù†ÙˆØ§Ø± Ú©Ù†Ø§Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§
st.sidebar.header("ØªÙ†Ø¸ÛŒÙ…Ø§Øª")

# 1. ÙˆØ±ÙˆØ¯ÛŒ Ú©Ù„ÛŒØ¯ API
# Ù†Ú©ØªÙ‡: Ù…Ø¯Ù„ gemini-2.0-flash ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯. Ø§Ø² Ø¢Ø®Ø±ÛŒÙ† Ù…Ø¯Ù„ flash ÛŒØ¹Ù†ÛŒ gemini-1.5-flash-latest Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ….
api_key = st.sidebar.text_input("ğŸ”‘ Ú©Ù„ÛŒØ¯ API Ú¯ÙˆÚ¯Ù„ Gemini Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:", type="password", help="Ú©Ù„ÛŒØ¯ API Ø´Ù…Ø§ Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ø¨Ø§Ù‚ÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯ Ùˆ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¬Ù„Ø³Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.")

if not api_key:
    st.warning("Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„ØŒ Ú©Ù„ÛŒØ¯ API Ú¯ÙˆÚ¯Ù„ Gemini Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ù†ÙˆØ§Ø± Ú©Ù†Ø§Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.")
    st.stop()

try:
    genai.configure(api_key=api_key)
    model = genai.GenerativeModel('gemini-1.5-flash-latest')
except Exception as e:
    st.error(f"âŒ Ø®Ø·Ø§ Ø¯Ø± ØªÙ†Ø¸ÛŒÙ… Ú©Ù„ÛŒØ¯ API: Ù„Ø·ÙØ§Ù‹ Ø§Ø² Ù…Ø¹ØªØ¨Ø± Ø¨ÙˆØ¯Ù† Ú©Ù„ÛŒØ¯ Ø®ÙˆØ¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø­Ø§ØµÙ„ Ú©Ù†ÛŒØ¯.")
    st.stop()

# 2. Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„
uploaded_file = st.file_uploader("ğŸ“‚ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ø­Ø§ÙˆÛŒ Ø¹Ù†Ø§ÙˆÛŒÙ† Ùˆ Ú†Ú©ÛŒØ¯Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú©Ù†ÛŒØ¯", type=["xlsx"])

if uploaded_file is not None:
    try:
        df = pd.read_excel(uploaded_file)
        st.success("âœ… ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯. Ù„Ø·ÙØ§ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø±Ø§ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.")
        st.dataframe(df.head())

        st.sidebar.header("Ø§Ù†ØªØ®Ø§Ø¨ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§")
        columns = df.columns.tolist()

        # 3. Ø§Ù†ØªØ®Ø§Ø¨ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§
        title_col = st.sidebar.selectbox("Ø³ØªÙˆÙ† Ø­Ø§ÙˆÛŒ **Ø¹Ù†ÙˆØ§Ù†** Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", columns, index=0)
        abstract_col = st.sidebar.selectbox("Ø³ØªÙˆÙ† Ø­Ø§ÙˆÛŒ **Ú†Ú©ÛŒØ¯Ù‡** Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:", columns, index=1 if len(columns) > 1 else 0)

        if st.button("ğŸš€ Ø´Ø±ÙˆØ¹ ØªØ­Ù„ÛŒÙ„", type="primary"):
            if title_col == abstract_col:
                st.error("Ø³ØªÙˆÙ† Ø¹Ù†ÙˆØ§Ù† Ùˆ Ú†Ú©ÛŒØ¯Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ÛŒÚ©Ø³Ø§Ù† Ø¨Ø§Ø´Ù†Ø¯.")
            else:
                with st.spinner("Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„... Ø§ÛŒÙ† ÙØ±Ø¢ÛŒÙ†Ø¯ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø³ØªÙ‡ Ø¨Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ø²Ù…Ø§Ù†â€ŒØ¨Ø± Ø¨Ø§Ø´Ø¯."):
                    progress_bar = st.progress(0, text="Ø´Ø±ÙˆØ¹ ÙØ±Ø¢ÛŒÙ†Ø¯ ØªØ­Ù„ÛŒÙ„...")
                    total_rows = len(df)
                    results = []

                    for i, row in df.iterrows():
                        title = str(row.get(title_col, ''))
                        abstract = str(row.get(abstract_col, ''))

                        if not title or not abstract:
                            results.append({
                                "Ù†ÙˆØ¢ÙˆØ±ÛŒ": "N/A", "ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ": "N/A",
                                "Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ": "N/A", "ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ": "Ø¹Ù†ÙˆØ§Ù† ÛŒØ§ Ú†Ú©ÛŒØ¯Ù‡ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª."
                            })
                        else:
                            prompt = create_prompt(title, abstract)
                            try:
                                response = model.generate_content(prompt)
                                parsed_data = parse_response(response.text)
                                results.append(parsed_data)
                            except Exception as e:
                                st.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø±Ø¯ÛŒÙ {i+1}: {e}")
                                results.append({
                                    "Ù†ÙˆØ¢ÙˆØ±ÛŒ": "Ø®Ø·Ø§", "ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ": "Ø®Ø·Ø§",
                                    "Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ": "Ø®Ø·Ø§", "ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ": str(e)
                                })
                        
                        # ÛŒÚ© ØªØ£Ø®ÛŒØ± Ú©ÙˆØªØ§Ù‡ Ø¨Ø±Ø§ÛŒ Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø±Ø³ÛŒØ¯Ù† Ø¨Ù‡ Ù…Ø­Ø¯ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ API
                        sleep(1) 
                        progress_bar.progress((i + 1) / total_rows, text=f"Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ø¯ÛŒÙ {i+1} Ø§Ø² {total_rows}")
                
                st.success("ğŸ‰ ØªØ­Ù„ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯!")

                # Ø§ÛŒØ¬Ø§Ø¯ DataFrame Ø§Ø² Ù†ØªØ§ÛŒØ¬ Ùˆ Ø§Ù„Ø­Ø§Ù‚ Ø¢Ù† Ø¨Ù‡ DataFrame Ø§ØµÙ„ÛŒ
                results_df = pd.DataFrame(results)
                
                # ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ ÙˆØ¶ÙˆØ­ Ø¨ÛŒØ´ØªØ±
                results_df.rename(columns={
                    "Ù†ÙˆØ¢ÙˆØ±ÛŒ": "Ø§Ù…ØªÛŒØ§Ø² Ù†ÙˆØ¢ÙˆØ±ÛŒ",
                    "ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ": "Ø§Ù…ØªÛŒØ§Ø² ØªØ¬Ø§Ø±ÛŒâ€ŒØ³Ø§Ø²ÛŒ",
                    "Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ": "Ø§Ù…ØªÛŒØ§Ø² Ø§Ø±Ø²Ø´â€ŒØ¢ÙØ±ÛŒÙ†ÛŒ",
                    "ØªØ­Ù„ÛŒÙ„ Ú©Ù„ÛŒ": "Ø®Ù„Ø§ØµÙ‡ ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ"
                }, inplace=True)
                
                final_df = pd.concat([df, results_df], axis=1)

                st.dataframe(final_df)

                # 4. Ø¯Ú©Ù…Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯
                excel_data = to_excel(final_df)
                st.download_button(
                    label="ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„ Ù†ØªØ§ÛŒØ¬",
                    data=excel_data,
                    file_name="ØªØ­Ù„ÛŒÙ„_Ù¾Ø§ÛŒØ§Ù†â€ŒÙ†Ø§Ù…Ù‡â€ŒÙ‡Ø§.xlsx",
                    mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
                )
    except Exception as e:
        st.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† ÙØ§ÛŒÙ„ Ø§Ú©Ø³Ù„: {e}")
